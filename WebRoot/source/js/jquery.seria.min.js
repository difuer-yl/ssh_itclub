/**
 * Seria - jQuery Slideshow Plugin
 *
 * http://plugins.gravitysign.com/seria
 * Copyright @ 2014 Roman Yurchuk
 * Version 1.3 # 26/01/14
 *
 */

(function(f,d){function c(o){var r=false,q=["Webkit","Moz","O","ms"];var t=document.createElement("div");if(typeof t.style[o]==="string"){r=o}else{var n=o.charAt(0).toUpperCase()+o.substr(1);for(var s in q){if(typeof t.style[q[s]+n]==="string"){r=q[s]+n;break}}}t=null;return r}function k(){var n={WebkitTransition:"-webkit-",MozTransition:"-moz-",msTransition:"-ms-",OTransition:"-o-",transition:""};if(/(Safari|Chrome)/.test(navigator.userAgent)){return n.WebkitTransition}return n[c("transition")]}function i(){var o=false,p=document.createElement("div"),n=c("transform");p.style[n]="rotateY(45deg)";if(p.style[n]!==""){o=true}p=null;return o}function l(q,p){var n={left:0,top:0};if(b&&p){var o=q.css(b);if(o.indexOf("matrix")===0){o=o.split("(")[1].split(")")[0].split(/,\s*/);n.left=parseInt(o[4],10);n.top=parseInt(o[5],10)}}else{n=q.position()}return n}function m(t,x,r,w,u,p){var y={linear:"linear",swing:"cubic-bezier(.02,.01,.47,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};var s={transition:"transitionend",OTransition:"oTransitionEnd otransitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend"};if(typeof u==="function"){p=u;u=0}x=x.split(/\s+/);r=(parseInt(r,10)/1000||0)+"s";w=y[w]||y.swing;u=(parseInt(u,10)/1000||0)+"s";p=p||f.noop;var o=s[h];t.off(o).on(o,function(n){if(this===n.originalEvent.target){t.off(o).css(h,"");p.call(t,o.propertyName)}n.stopPropagation()});var v="";for(var q=0;q<x.length;q++){v+=x[q]+" "+r+" "+w+" "+u+", "}t.css(h,v.slice(0,-2))}function e(p,r,q,s,o,n){if(q>0){if(r!==l(p,true).top){m(p,a+"transform",q,s,o,n)}}else{if(q===0){n();return}}if(j){p.css(b,"translate3d(0px, "+parseInt(r,10)+"px, 0px)")}else{p.css(b,"translate(0px, "+parseInt(r,10)+"px)")}}var h=c("transition");var b=c("transform");var a=k();var j=i();function g(t,q){this.container=f(t);this.settings=q;this.list=this.container.find(".seria-list");this.items=this.list.children();this.total=this.items.length;this.offset=0;this.visible=3;this.lock=false;this.expanded=false;this.ready=false;this.css3=this.settings.css3&&h;if(this.settings.mode==="normal"){this.list.prepend('<li class="seria-empty"></li>');this.list.append('<li class="seria-empty"></li>');this.items=this.list.children();this.total=this.items.length}this.container.css({height:this.settings.height,"max-width":this.settings.maxWidth});this.items.addClass("seria-item");this.mobile_about=f('<div class="seria-mobile-about"></div>');for(var r=0;r<this.total;r++){var p=this.items.eq(r).find(".seria-about").clone(true);if(!p.length){p=f('<div class="seria-empty"></div>')}this.mobile_about.append(p)}this.container.after(this.mobile_about);f('<div class="seria-cover-top"></div><div class="seria-cover-bottom"></div>').css({opacity:this.settings.adjacentOpacity,"background-color":this.settings.adjacentColor}).appendTo(this.container);if(this.settings.navigation){f('<div class="seria-navigation"><a class="seria-prev"><span>Previous</span></a><a class="seria-next"><span>Next</span></a></div>').appendTo(this.container);this.container.find(".seria-next").click(f.proxy(function(){this.one("up")},this)).end().find(".seria-prev").click(f.proxy(function(){this.one("down")},this))}if(this.settings.pagination){var o=f('<ul class="seria-pagination"></ul>');for(var r=0;r<this.total;r++){f("<a>"+(r+1)+"</a>").click(f.proxy(function(s){this.rewind(s)},this,r)).wrap("<li></li>").parent().appendTo(o);if(this.items.eq(r).hasClass("seria-empty")){o.children(":last-child").hide()}}o.appendTo(this.container).css("height",o.outerHeight())}if(this.settings.photoExpand){f("<a><span>Expand</span></a>").click(f.proxy(function(){this.expandPhoto(!this.expanded)},this)).wrap('<div class="seria-expand"></div>').parent().appendTo(this.container)}if(!this.settings.fadeSync){this.settings.delay=parseInt(this.settings.delay,10)+parseInt(this.settings.fadeDuration,10)}if(this.settings.mode==="normal"){this.settings.startWith+=1}this.setupLayout();this.preloadImages(function(n){this.adaptImages();f(n).fadeIn(300)},function(){this.ready=true;this.container.addClass("seria-ready");if(typeof this.settings.onReady==="function"){this.settings.onReady.call(this.container[0])}});this.one("down");this.rewind(this.settings.startWith);f(window).resize(f.proxy(function(){this.setupLayout();this.adaptImages()},this));this.api={oneup:function(){this.one("up")},onedown:function(){this.one("down")},rewind:function(s){this.rewind(s)},expand:function(){this.expandPhoto(true)},collapse:function(){this.expandPhoto(false)}};this.container.on("seria",f.proxy(function(n,u,s){if(this.api.hasOwnProperty(u)){this.api[u].call(this,s)}},this))}g.prototype.preloadImages=function(o,p){var q,n=this.items.find(".seria-photo img");n.hide();q=window.setInterval(f.proxy(function(){var r=this,s=n.length;n.each(function(){if(this.complete===true){s--;n=n.not(this);if(o){o.call(r,this)}}});if(s===0){window.clearInterval(q);if(p){p.call(this)}}},this),200)};g.prototype.adaptImages=function(){var n=this;this.items.each(function(){var q=f(this).find(".seria-photo"),p=q.find("img"),o=true,r=0;if(!p.length||p[0].complete===false){return}if(q.width()/q.height()>p.width()/p.height()){o=true}else{o=false}q.removeClass("seria-landscape seria-portrait").addClass(o?"seria-landscape":"seria-portrait");if(n.settings.centerImages){p.css("margin","");if(o){r=p.height()-q.height();p.css("margin-top",-r/2)}else{r=p.width()-q.width();p.css("margin-left",-r/2)}}else{p.css({"margin-top":"","margin-left":""})}})};g.prototype.one=function(q,s){q=q||"up";if(this.lock){return}if(this.expanded&&this.settings.photoExpandStyle==="style1"){return}this.lock=true;var o=-this.offset*Math.round(this.item_height);if(q==="down"){if(this.offset===0){if(this.settings.mode==="carousel"){var p=this.list.children(":last");this.list.prepend(p);if(this.css3){e(this.list,o-Math.round(this.item_height))}else{this.list.css("top",o-Math.round(this.item_height))}}else{if(this.container.hasClass("seria-first-item")){this.lock=false;return}}}else{o+=Math.round(this.item_height);this.offset=this.offset-1}}else{if(this.offset===this.total-this.visible){if(this.settings.mode==="carousel"){var r=this.list.children(":first");this.list.append(r);if(this.css3){e(this.list,o+Math.round(this.item_height))}else{this.list.css("top",o+Math.round(this.item_height))}}else{if(this.container.hasClass("seria-last-item")){this.lock=false;return}}}else{o-=Math.round(this.item_height);this.offset=this.offset+1}}if(typeof this.settings.onStart==="function"&&this.ready&&!this.rewinding){this.settings.onStart.apply(this.container[0],[this.mobile?this.mobile_about.children(".seria-current")[0]:this.list.children(".seria-current")[0],q])}this.hideAbout(q);this.list.children(".seria-current").removeClass("seria-current");this.mobile_about.children(".seria-current").removeClass("seria-current");this.container.find(".seria-pagination > li").removeClass("seria-current").eq(this.currentIndex(true)).addClass("seria-current");var n=function(){if(this.settings.mode==="normal"){var t="";if(this.offset===this.total-this.visible){t="seria-last-item"}if(this.offset===0){t="seria-first-item"}this.container.removeClass("seria-first-item seria-last-item").addClass(t)}this.list.children().eq(this.currentIndex()).addClass("seria-current");this.mobile_about.children().eq(this.currentIndex(true)).addClass("seria-current");this.showAbout(q);this.lock=false;if(typeof this.settings.onEnd==="function"&&this.ready&&!this.rewinding){this.settings.onEnd.apply(this.container[0],[this.mobile?this.mobile_about.children(".seria-current")[0]:this.list.children(".seria-current")[0],q])}if(s){s.call(this)}};if(this.ready){if(this.css3){e(this.list,o,this.settings.duration,this.settings.easing,this.settings.delay,f.proxy(n,this))}else{this.list.stop(true).delay(this.settings.delay).animate({top:o},this.settings.duration,this.settings.easing,f.proxy(n,this))}}else{if(this.css3){e(this.list,o)}else{this.list.css("top",o)}n.call(this)}};g.prototype.rewind=function(n,o){n=parseInt(n,10);if(isNaN(n)||n<0||n>this.total-1){return}if(n!==this.currentIndex(true)||o){if(this.settings.rewindFast){if(!this.rewind_tmp){this.rewind_tmp=[this.settings.duration,this.settings.delay];this.settings.duration=0;this.settings.delay=0}if(Math.abs(n-this.currentIndex(true))===1){this.settings.duration=this.rewind_tmp[0];this.settings.delay=this.rewind_tmp[1];delete this.rewind_tmp}}this.rewinding=!(Math.abs(n-this.currentIndex(true))===1);this.one(n>this.currentIndex(true)?"up":"down",function(){this.rewind(n)})}else{if(this.rewind_tmp){this.settings.duration=this.rewind_tmp[0];this.settings.delay=this.rewind_tmp[1];delete this.rewind_tmp}}};g.prototype.currentIndex=function(n){var o=this.offset+1;if(!n){return o}var p=this.list.children(":eq("+o+")");return this.items.index(p)};g.prototype.setupLayout=function(){var o=this.container.height(),n=parseInt(this.settings.adjacentVisible,10),t=false,q=this.currentIndex(true),p=(this.mobile_about.css("display")==="block");if(p&&!this.mobile){this.mobile=true;t=true}else{if(!p&&this.mobile){this.mobile=false;t=true}else{this.mobile=p}}if(this.ready&&!t){return}if(this.mobile){n=0}this.item_height=o*(1-n/150);this.items.height(Math.round(this.item_height));var r=o*(1-n/100);this.list.css("margin-top",-Math.round(r));var s=Math.round(this.item_height-r);this.container.find(".seria-cover-top, .seria-cover-bottom").height(s).end().find(".seria-navigation").css("margin-bottom",s).end().find(".seria-expand").css("margin-top",s);if(t){if(this.mobile){this.expandPhoto(false)}this.container.removeClass("seria-first-item seria-last-item");this.list.add(this.mobile_about).find(".seria-about").hide();this.rewind(q,true);this.container.toggleClass("seria-mobile")}};g.prototype.showAbout=function(p,o){if(this.mobile){o=this.mobile_about.children(".seria-current")}else{o=this.list.children(".seria-current").find(".seria-about")}var r=(p==="up")?1:-1,q={display:"block",opacity:0},n={opacity:1};if(this.settings.fade==="horizontal"&&!this.mobile){q.left=r*parseFloat(this.settings.fadeOffset);n.left=0}else{if(this.settings.fade==="vertical"&&!this.mobile){q.top=r*parseFloat(this.settings.fadeOffset);n.top=0}}o.css(q).stop(true).animate(n,this.settings.fade,this.settings.fadeEasing);if(this.mobile){this.mobile_about.stop(true).animate({height:o.outerHeight()},this.settings.fade,"swing")}};g.prototype.hideAbout=function(q,p){if(this.mobile){p=this.mobile_about.children(".seria-current")}else{p=this.list.children(".seria-current").find(".seria-about")}var n=(q==="up")?-1:1,r={},o={opacity:0};if(!this.mobile&&this.settings.fade==="horizontal"){o.left=n*parseInt(this.settings.fadeOffset,0)}else{if(!this.mobile&&this.settings.fade==="vertical"){o.top=n*parseInt(this.settings.fadeOffset,0)}}p.css(r).stop(true).animate(o,this.settings.fadeDuration,this.settings.fadeEasing,function(){p.hide()})};g.prototype.expandPhoto=function(o){if(this.lock||!this.settings.photoExpand){return}if(this.mobile&&o){return}if(this.expanded===o){return}var n=this.list.children().eq(this.currentIndex()).find(".seria-about");if(o){this.container.addClass("seria-expanded seria-expand-"+this.settings.photoExpandStyle);n.hide();if(typeof this.settings.onExpand==="function"){this.settings.onExpand.call(this.container[0],this.items.eq(this.currentIndex(true))[0])}}else{this.container.removeClass("seria-expanded seria-expand-"+this.settings.photoExpandStyle);n.fadeIn(this.settings.fadeDuration);if(typeof this.settings.onCollapse==="function"){this.settings.onCollapse.call(this.container[0],this.items.eq(this.currentIndex(true))[0])}}this.adaptImages();this.imagePanning(o);this.expanded=o};g.prototype.imagePanning=function(p){var n,q,o;if(!this.settings.photoPanning){return}if(!p){this.container.find(".seria-panning-help").remove();this.container.off("mousedown.seria",".seria-photo");f("body").off("mouseup.seria");return}f('<div class="seria-panning-help"></div>').appendTo(this.container).fadeIn(300).delay(1500).fadeOut(300,function(){f(this).remove()});this.container.on("mousedown.seria",".seria-photo",function(w){o=f(this);n=w.pageX;q=w.pageY;var s=o.find("img"),r=parseFloat(s.css("margin-top"))||0,v=parseFloat(s.css("margin-left"))||0,u=o.width()-s.width(),t=o.height()-s.height();var x=f(this).hasClass("seria-landscape");if(u||t){o.addClass("seria-panning")}f(this).on("mousemove.seria",function(A){var z=A.pageX-n,y=A.pageY-q;if(x){if(r+y<0&&r+y>t){s.css("margin-top",r+y)}}else{if(v+z<0&&v+z>u){s.css("margin-left",v+z)}}});f(this).find("img").on("dragstart",false)});f("body").on("mouseup.seria",function(){if(o){o.removeClass("seria-panning").off("mousemove.seria").find("img").off("dragstart")}})};f.fn.seria=function(o){var n=f.extend({css3:true,mode:"carousel",delay:0,duration:500,easing:"swing",fade:"none",fadeDuration:300,fadeEasing:"swing",fadeOffset:40,fadeSync:false,height:false,maxWidth:false,adjacentVisible:70,adjacentOpacity:0.8,adjacentColor:"#fff",rewindFast:true,startWith:0,centerImages:true,photoExpand:true,photoExpandStyle:"style1",photoPanning:true,navigation:true,pagination:true,onReady:function(){},onStart:function(){},onEnd:function(){},onExpand:function(){},onCollapse:function(){}},o);return this.each(function(){var p=new g(this,n)})}})(jQuery);